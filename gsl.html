<!DOCTYPE html>
<html>

<head>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>

<body>
    <h3>My Google Maps Demo</h3>
    <input id='search-text' type='text'>
    <button type='submit' onClick='processSearchValue("search-text")'>Search</button>
    <div id="map"></div>
    <script>

        function processSearchValue(targetdiv) {
            let value = document.getElementById(targetdiv).value;
            let latLong = getStoreByPostCode(baseurl, value, (responseText) => {
                const latLong = createLatLongObj(responseText);
                let location = { lat: latLong.lat, lng: latLong.long };
                let map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 12,
                    center: location
                });
                let marker = new google.maps.Marker({
                    position: location,
                    map: map
                });
            });
        }

        const baseurl =
            'https://costa-platform-uat.com/locations/stores?countryCode=UK&';

        function createLatLongObj(responseText) {
            const long = responseText.stores[0].longitude;
            const lat = responseText.stores[0].latitude;
            const latLong = {
                'long': parseFloat(long),
                'lat': parseFloat(lat)
            };
            return latLong;
        }

        function getStoreByPostCode(theUrl, postalCode, callback) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                    let respObj = JSON.parse(xmlHttp.responseText);
                    callback(respObj);
                }
            }
            xmlHttp.open("GET", theUrl + 'postalCode=' + postalCode, true); // true marks asynchronous 
            xmlHttp.send(null);
        }

        // function displayStores() {
        //     let latLong = getStoreByPostCode(baseurl, 'EC1N2TD', (responseText) => {
        //         const latLong = createLatLongObj(responseText);
        //         var london = { lat: latLong.lat, lng: latLong.long };
        //         var map = new google.maps.Map(document.getElementById('map'), {
        //             zoom: 12,
        //             center: london
        //         });
        //         var marker = new google.maps.Marker({
        //             position: london,
        //             map: map
        //         });
        //     });
        // }

        function initMap() {
            const defaultLocation = {
                lat: 51.507222,
                lng: -0.1275
            };
            let map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: defaultLocation
            });
            let marker = new google.maps.Marker({
                position: defaultLocation,
                map: map
            });
        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDL8Bx9LKau7b2Xa0LG16aGd53kTdiHbfQ&callback=initMap">
    </script>
</body>

</html>